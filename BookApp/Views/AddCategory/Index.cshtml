@model BookApp.Models.CategoryViewModel
@{
    ViewData["Title"] = "Add category";
}

<html>
<head>
    <link rel="stylesheet" href="~/css/AddCategory.css" asp-append-version="true" />
    <link rel="stylesheet" href="path/to/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="path/to/font-awesome/css/font-awesome.min.css">
</head>

<body>
    @using (Html.BeginForm("AddCategoryName", "AddCategory", FormMethod.Post))
    {
        <div class="CategoryInformation">
            <h1 class="CategoryName">Add category name</h1>
            @Html.AntiForgeryToken()
            @Html.TextBoxFor(model => model.Name, new { id = "AddPatternName", placeholder = "Enter category name..." })
        </div>

        <button type="submit" class="AddCategoryButton">Add category</button>
    }
    
    <div class="Categories">
        @if (Model.Categories != null)
        {  
            <p class="categorytype">Standard Categories</p>
            @foreach (var categoryDTO in Model.Categories.Where(c => c.IsStandard == true))
            {
                <p class="categoryNames">@categoryDTO.Name</p>
                <div class="Icons">
                </div>
                <hr class="line">
            }
     
            <p class="categorytype">Your Categories</p>
            @foreach (var categoryDTO in Model.Categories.Where(c => c.IsStandard == false))
            {
                <p id="categoryName_@categoryDTO.Id" class="categoryNames">@categoryDTO.Name</p>
                <div class="Icons">
                    <i class="fa-solid fa-pen-to-square" onclick="openEditPopup('@categoryDTO.Id', '@categoryDTO.Name')"></i>
                    <i class="fa-solid fa-trash-can" onclick="deleteCategory('@categoryDTO.Id')"></i>
                </div>
                <hr class="line">
            }
        }
        else
        {
            <p>No categories available.</p>
        }

    </div>
    
    <div id="editCategoryModal" class="modal">
        <div class="modalContent">
            <span class="close" onclick="closeEditPopup()">&times;</span>
            <h2>Edit Category</h2>
            <input type="hidden" id="editCategoryId">
            <input type="text" id="editedCategoryName" class="editCategoryInput">
            <button onclick="saveEditedCategory()" class="saveButton">Save</button>
        </div>
    </div>

    <script>
        function openEditPopup(categoryId, categoryName) {
            document.getElementById('editCategoryId').value = categoryId;
            document.getElementById('editedCategoryName').value = categoryName;
            document.getElementById('editCategoryModal').style.display = 'block';
        }

        function closeEditPopup() {
            document.getElementById('editCategoryModal').style.display = 'none';
        }

        // Save Edited Category
        function saveEditedCategory() {
            var categoryId = document.getElementById('editCategoryId').value;
            var editedCategoryName = document.getElementById('editedCategoryName').value;

            $.ajax({
                url: '@Url.Action("UpdateCategoryName", "AddCategory")',
                type: 'POST',
                data: { id: categoryId, name: editedCategoryName },
                success: function (result) {
                    if (result.success) {
                        closeEditPopup();
                        location.reload();
                    } else {
                        alert(result.message);
                    }
                },
                error: function (xhr, status, error) {
                    console.error(xhr.responseText);
                    alert('An error occurred while updating the category.');
                }
            });
        }
        
        // Delete Category
        function deleteCategory(categoryId) {
            if (confirm('Are you sure you want to delete this category?')) {
                $.ajax({
                    url: '@Url.Action("DeleteCategory", "AddCategory")',
                    type: 'POST',
                    data: { id: categoryId },
                    success: function (result) {
                        if (result.success) {
                            location.reload();
                        } else {
                            alert(result.message);
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error(xhr.responseText);
                        alert('An error occurred while deleting the category.');
                    }
                });
            }
        }
    </script>
</body>
</html>
